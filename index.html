<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Planning DIGIY LOC ‚Äî Chez Baptiste</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg:#022c22;          /* Vert profond S√©n√©gal */
      --bg-soft:#064e3b;
      --card:#052e16;
      --accent:#facc15;      /* Or DIGIY */
      --accent-soft:rgba(250,204,21,0.14);
      --text:#f9fafb;
      --muted:#cbd5f5;
      --line:#0f172a;

      --free:#064e3b;        /* Libre DIGIY */
      --digiy:#16a34a;       /* R√©serv√© DIGIY */
      --ota:#b91c1c;         /* Booking / OTA */
      --closed:#4b5563;      /* Ferm√© */

      --font-main: -apple-system,BlinkMacSystemFont,"Outfit","Manrope",system-ui,sans-serif;
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
    }

    body{
      min-height:100vh;
      background:
        radial-gradient(circle at top,#16a34a33 0,transparent 55%),
        linear-gradient(135deg,#022c22,#065f46);
      color:var(--text);
      font-family:var(--font-main);
      padding:16px 10px 22px;
      display:flex;
      justify-content:center;
    }

    .page{
      width:100%;
      max-width:1040px;
    }

    /* HEADER */
    .header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }

    .header-left{
      display:flex;
      gap:10px;
      align-items:center;
    }

    .logo{
      width:44px;
      height:44px;
      border-radius:16px;
      background:radial-gradient(circle at 25% 10%,#ecfeff,#22c55e);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 0 24px rgba(16,185,129,0.8);
      color:#022c22;
      font-weight:900;
      font-size:20px;
    }

    .title-block h1{
      font-size:20px;
      letter-spacing:0.06em;
      text-transform:uppercase;
      font-weight:800;
    }

    .title-block .subtitle{
      font-size:14px;
      color:var(--muted);
      margin-top:4px;
    }

    .header-right{
      text-align:right;
      font-size:13px;
      color:var(--muted);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(52,211,153,0.7);
      background:rgba(6,95,70,0.6);
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      margin-bottom:4px;
    }

    /* CARD GLOBALE */
    .card{
      background:linear-gradient(145deg,rgba(5,46,22,0.98),rgba(6,95,70,0.96));
      border-radius:22px;
      border:1px solid rgba(16,185,129,0.65);
      padding:14px 14px 16px;
      box-shadow:
        0 26px 70px rgba(0,0,0,0.85),
        0 0 0 1px rgba(15,23,42,0.7);
    }

    /* BARRE DU HAUT : date + navigation */
    .top-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }

    .date-range-title{
      font-size:15px;
      font-weight:700;
    }

    .date-range-sub{
      font-size:13px;
      color:var(--muted);
    }

    .nav-buttons{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }

    button{
      font-family:var(--font-main);
    }

    .btn{
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.4);
      background:rgba(15,23,42,0.75);
      color:var(--text);
      padding:8px 13px;
      font-size:13px;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn:hover{
      border-color:var(--accent);
      box-shadow:0 0 14px rgba(250,204,21,0.35);
    }
    .btn-ghost{
      background:transparent;
    }
    .btn-primary{
      background:linear-gradient(135deg,#facc15,#eab308);
      color:#022c22;
      border-color:rgba(250,204,21,0.75);
      box-shadow:0 10px 26px rgba(250,204,21,0.6);
    }

    /* L√âGENDE */
    .legend{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:10px;
      font-size:12px;
      color:var(--muted);
    }

    .legend-item{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 8px;
      border-radius:999px;
      background:rgba(15,23,42,0.8);
      border:1px solid rgba(148,163,184,0.5);
    }

    .legend-color{
      width:14px;
      height:14px;
      border-radius:4px;
    }

    .lg-free{background:var(--free);}
    .lg-digiy{background:var(--digiy);}
    .lg-ota{background:var(--ota);}
    .lg-closed{background:var(--closed);}

    /* PLANNING TABLE SCROLLABLE */
    .planning-wrapper{
      margin-top:8px;
      border-radius:18px;
      border:1px solid rgba(15,23,42,0.9);
      background:rgba(15,23,42,0.85);
      overflow:hidden;
    }

    .planning-scroll{
      width:100%;
      overflow-x:auto;
    }

    table{
      border-collapse:collapse;
      width:100%;
      min-width:720px;
    }

    th, td{
      border-bottom:1px solid rgba(31,41,55,0.9);
      border-right:1px solid rgba(31,41,55,0.9);
    }

    th{
      background:rgba(15,23,42,0.95);
      font-size:13px;
      font-weight:700;
      padding:10px 8px;
      text-align:center;
      position:sticky;
      top:0;
      z-index:2;
    }

    .col-room{
      min-width:160px;
      text-align:left;
      position:sticky;
      left:0;
      z-index:3;
      background:rgba(15,23,42,0.98);
    }

    .room-name{
      font-size:14px;
      font-weight:700;
    }
    .room-sub{
      font-size:12px;
      color:var(--muted);
      margin-top:2px;
    }

    .day-label{
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      color:var(--muted);
    }
    .day-date{
      font-size:13px;
      font-weight:700;
    }

    td{
      padding:6px 4px;
      text-align:center;
    }

    .day-cell{
      font-size:13px;
      min-width:46px;
      height:48px;
      cursor:pointer;
      border-radius:10px;
      padding:4px 3px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      gap:2px;
    }

    .status-free{
      background:rgba(6,95,70,0.7);
      color:#bbf7d0;
    }

    .status-digiy{
      background:rgba(22,163,74,0.9);
      color:#ecfdf5;
    }

    .status-ota{
      background:rgba(185,28,28,0.9);
      color:#fee2e2;
    }

    .status-closed{
      background:rgba(55,65,81,0.9);
      color:#e5e7eb;
    }

    .cell-tag{
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.09em;
      opacity:0.9;
    }
    .cell-main{
      font-size:12px;
      font-weight:600;
    }

    /* FORMULAIRE AJOUT R√âSA */
    .form-section{
      margin-top:16px;
      display:grid;
      grid-template-columns:1.8fr 1.2fr;
      gap:12px;
      flex-wrap:wrap;
    }

    @media(max-width:768px){
      .form-section{
        grid-template-columns:1fr;
      }
    }

    .form-card{
      border-radius:18px;
      border:1px solid rgba(15,23,42,0.9);
      background:rgba(15,23,42,0.9);
      padding:12px 12px 14px;
    }

    .form-title{
      font-size:14px;
      text-transform:uppercase;
      letter-spacing:0.14em;
      color:var(--muted);
      margin-bottom:6px;
    }

    .field-row{
      display:grid;
      grid-template-columns:1.4fr 1.4fr;
      gap:8px;
      margin-bottom:8px;
    }

    @media(max-width:640px){
      .field-row{
        grid-template-columns:1fr;
      }
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:3px;
    }

    label{
      font-size:12px;
      color:var(--muted);
      letter-spacing:0.06em;
      text-transform:uppercase;
    }

    .required::after{
      content:"*";
      margin-left:3px;
      color:var(--accent);
    }

    input, select{
      border-radius:10px;
      border:1px solid rgba(55,65,81,0.9);
      background:rgba(15,23,42,0.97);
      color:var(--text);
      padding:8px 9px;
      font-size:14px;
      outline:none;
    }

    input:focus, select:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(250,204,21,0.4);
    }

    .hint{
      font-size:11px;
      color:var(--muted);
    }

    #status{
      margin-top:6px;
      font-size:12px;
      min-height:18px;
    }
    .status-ok{color:#bbf7d0;}
    .status-error{color:#fecaca;}

    /* PETIT R√âCAP */
    .small-list{
      font-size:13px;
      color:var(--muted);
      max-height:190px;
      overflow:auto;
    }

    .small-row{
      padding:6px 0;
      border-bottom:1px dashed rgba(55,65,81,0.8);
    }

    .small-row strong{
      color:var(--accent);
    }
  </style>
</head>
<body>
<div class="page">

  <!-- HEADER -->
  <header class="header">
    <div class="header-left">
      <div class="logo">DL</div>
      <div class="title-block">
        <h1>DIGIY LOC ‚Äî Chez Baptiste</h1>
        <div class="subtitle">
          Appartement 2 chambres ‚Ä¢ Capacit√© 4 personnes ‚Ä¢ 0% commission, r√©servation directe.
        </div>
      </div>
    </div>
    <div class="header-right">
      <div class="badge">PLANNING 14 JOURS</div>
      <div>Synchronis√© avec Supabase DIGIY CORE</div>
      <div style="font-size:12px;">Business : <strong>chez-baptiste</strong></div>
    </div>
  </header>

  <main class="card">
    <!-- TOP BAR -->
    <div class="top-row">
      <div>
        <div class="date-range-title" id="dateRangeTitle">Planning</div>
        <div class="date-range-sub" id="dateRangeSub"></div>
      </div>
      <div class="nav-buttons">
        <button class="btn btn-ghost" id="btnPrev">‚óÄ 14 jours</button>
        <button class="btn btn-ghost" id="btnToday">Aujourd‚Äôhui</button>
        <button class="btn btn-ghost" id="btnNext">14 jours ‚ñ∂</button>
      </div>
    </div>

    <!-- L√âGENDE -->
    <div class="legend">
      <div class="legend-item">
        <span class="legend-color lg-free"></span>
        <span>Libre (DIGIY)</span>
      </div>
      <div class="legend-item">
        <span class="legend-color lg-digiy"></span>
        <span>R√©serv√© DIGIY</span>
      </div>
      <div class="legend-item">
        <span class="legend-color lg-ota"></span>
        <span>Occup√© Booking / OTA</span>
      </div>
      <div class="legend-item">
        <span class="legend-color lg-closed"></span>
        <span>Ferm√©</span>
      </div>
    </div>

    <!-- PLANNING -->
    <div class="planning-wrapper">
      <div class="planning-scroll">
        <table id="planningTable">
          <!-- rempli par JS -->
        </table>
      </div>
    </div>

    <!-- FORMULAIRE + R√âCAP -->
    <section class="form-section">
      <div class="form-card">
        <div class="form-title">Ajouter une r√©servation</div>
        <form id="resaForm">
          <div class="field-row">
            <div class="field">
              <label for="guestName" class="required">Nom du client</label>
              <input id="guestName" required placeholder="Ex. Famille Ndiaye">
            </div>
            <div class="field">
              <label for="phone">T√©l√©phone / WhatsApp</label>
              <input id="phone" placeholder="+221 77 ...">
            </div>
          </div>

          <div class="field-row">
            <div class="field">
              <label for="checkIn" class="required">Arriv√©e (check-in)</label>
              <input id="checkIn" type="date" required>
            </div>
            <div class="field">
              <label for="checkOut" class="required">D√©part (check-out)</label>
              <input id="checkOut" type="date" required>
            </div>
          </div>

          <div class="field-row">
            <div class="field">
              <label for="source" class="required">Source</label>
              <select id="source" required>
                <option value="digiy">DIGIY (direct)</option>
                <option value="direct">Direct (t√©l√©phone)</option>
                <option value="booking">Booking.com</option>
                <option value="ota">Autre OTA</option>
              </select>
            </div>
            <div class="field">
              <label for="comment">Notes</label>
              <input id="comment" placeholder="Ex. Arriv√©e tardive, 4 personnes‚Ä¶">
            </div>
          </div>

          <button type="submit" class="btn btn-primary" id="btnSave">
            ü¶Ö Enregistrer dans Supabase
          </button>

          <div id="status"></div>
          <div class="hint">
            Les r√©servations sont enregistr√©es dans <strong>loc_reservations</strong> et bloquent l‚Äôappartement sur la p√©riode choisie.
          </div>
        </form>
      </div>

      <div class="form-card">
        <div class="form-title">R√©servations √† venir</div>
        <div class="small-list" id="resaList">
          <!-- rempli par JS -->
        </div>
      </div>
    </section>

  </main>
</div>

<script>
  // üëâ Supabase DIGIY CORE (tes valeurs)
  const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";

  const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // üëâ State planning
  const state = {
    startDate: stripTime(new Date()),
    days: 14,
    rooms: [],
    reservations: []
  };

  // ‚Äî‚Äî Helpers date ‚Äî‚Äî
  function stripTime(d){
    const x = new Date(d);
    x.setHours(0,0,0,0);
    return x;
  }

  function addDays(d,n){
    const x = new Date(d);
    x.setDate(x.getDate()+n);
    return x;
  }

  function toISODate(d){
    return d.toISOString().slice(0,10);
  }

  function formatDateFR(d){
    return d.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"});
  }

  function formatDayFR(d){
    return d.toLocaleDateString("fr-FR",{weekday:"short"});
  }

  // üëâ MIS √Ä JOUR du bandeau de dates
  function updateDateHeader(){
    const start = state.startDate;
    const end   = addDays(start, state.days-1);
    const title = document.getElementById("dateRangeTitle");
    const sub   = document.getElementById("dateRangeSub");

    title.textContent = "Planning " + formatDateFR(start) + " ‚Üí " + formatDateFR(end);
    sub.textContent   = state.days + " jours de visibilit√© ‚Äî Appartement complet Chez Baptiste";
  }

  // üëâ Charger rooms + reservations depuis Supabase
  async function loadData(){
    setStatus("Chargement du planning en cours‚Ä¶","info");

    const startISO = toISODate(state.startDate);
    const endISO   = toISODate(addDays(state.startDate, state.days)); // exclusif

    // 1) Rooms (Chez Baptiste uniquement)
    const { data: rooms, error: roomsError } = await client
      .from("loc_rooms")
      .select("*")
      .eq("business_slug","chez-baptiste")
      .order("name",{ascending:true});

    if(roomsError){
      console.error(roomsError);
      setStatus("Erreur chargement chambres : " + roomsError.message,"error");
      return;
    }
    if(!rooms || rooms.length === 0){
      setStatus("Aucune chambre trouv√©e pour 'chez-baptiste'. V√©rifie la table loc_rooms.","error");
      state.rooms = [];
      renderPlanning();
      return;
    }
    state.rooms = rooms;

    // 2) Reservations qui se chevauchent avec la p√©riode
    // condition: check_in < endISO AND check_out > startISO
    const { data: resas, error: resError } = await client
      .from("loc_reservations")
      .select("*")
      .lt("check_in", endISO)
      .gt("check_out", startISO)
      .order("check_in",{ascending:true});

    if(resError){
      console.error(resError);
      setStatus("Erreur chargement r√©servations : " + resError.message,"error");
      state.reservations = [];
    } else {
      state.reservations = resas || [];
      setStatus("Planning synchronis√© avec Supabase.","ok");
    }

    updateDateHeader();
    renderPlanning();
    renderResaList();
  }

  // üëâ Trouver r√©servation pour une chambre et une date donn√©e
  function findReservationForCell(roomId, day){
    const dISO = toISODate(day);
    // On travaille en mode: check_in <= d < check_out
    return state.reservations.find(r => {
      if(r.room_id !== roomId) return false;
      const ci = new Date(r.check_in+"T00:00:00");
      const co = new Date(r.check_out+"T00:00:00");
      const dd = stripTime(day);
      return ci <= dd && dd < co;
    });
  }

  // üëâ Rendu planning
  function renderPlanning(){
    const table = document.getElementById("planningTable");
    table.innerHTML = "";

    // En-t√™te
    const thead = document.createElement("thead");
    const trHead = document.createElement("tr");

    const thRoom = document.createElement("th");
    thRoom.className = "col-room";
    thRoom.innerHTML = "Logement";
    trHead.appendChild(thRoom);

    for(let i=0;i<state.days;i++){
      const d = addDays(state.startDate,i);
      const th = document.createElement("th");
      const day = formatDayFR(d);
      const date = formatDateFR(d);
      th.innerHTML = `
        <div class="day-label">${day}</div>
        <div class="day-date">${date}</div>
      `;
      trHead.appendChild(th);
    }

    thead.appendChild(trHead);
    table.appendChild(thead);

    // Corps (une ligne par chambre)
    const tbody = document.createElement("tbody");

    state.rooms.forEach(room => {
      const tr = document.createElement("tr");

      // Colonne logement
      const tdRoom = document.createElement("td");
      tdRoom.className = "col-room";
      tdRoom.innerHTML = `
        <div class="room-name">${room.name}</div>
        <div class="room-sub">Capacit√© ${room.capacity || 4} pers ‚Ä¢ Code ${room.code || "-"}</div>
      `;
      tr.appendChild(tdRoom);

      // Colonnes jours
      for(let i=0;i<state.days;i++){
        const d = addDays(state.startDate,i);
        const resa = findReservationForCell(room.id, d);

        const td = document.createElement("td");
        const cell = document.createElement("div");
        cell.className = "day-cell";

        let cls = "";
        let tag = "";
        let main = "";

        if(room.status && room.status !== "open"){
          cls = "status-closed";
          tag = "Ferm√©";
          main = "";
        } else if(resa){
          const src = (resa.source || "digiy").toLowerCase();
          if(src === "booking" || src === "ota" || src === "expedia"){
            cls = "status-ota";
            tag = src === "booking" ? "Booking" : "OTA";
          } else {
            cls = "status-digiy";
            tag = "DIGIY";
          }
          main = resa.guest_name || "R√©serv√©";
        } else {
          cls = "status-free";
          tag = "Libre";
          main = "R√©servable";
        }

        cell.classList.add(cls);
        cell.innerHTML = `
          <div class="cell-tag">${tag}</div>
          <div class="cell-main">${main}</div>
        `;

        // Petit tooltip console pour debug si besoin
        cell.onclick = () => {
          if(resa){
            alert(
              "R√©servation : " + (resa.guest_name || "") + "\n" +
              "Source : " + (resa.source || "digiy") + "\n" +
              "Arriv√©e : " + resa.check_in + "\n" +
              "D√©part : " + resa.check_out
            );
          } else if(room.status && room.status !== "open"){
            alert("Logement ferm√© ce jour-l√†.");
          } else {
            alert("Jour libre. Tu peux ajouter une r√©servation avec le formulaire en bas.");
          }
        };

        td.appendChild(cell);
        tr.appendChild(td);
      }

      tbody.appendChild(tr);
    });

    table.appendChild(tbody);
  }

  // üëâ Liste compacte des r√©servations √† venir
  function renderResaList(){
    const box = document.getElementById("resaList");
    box.innerHTML = "";

    if(!state.reservations || state.reservations.length === 0){
      box.textContent = "Aucune r√©servation dans la p√©riode affich√©e.";
      return;
    }

    const nowISO = toISODate(stripTime(new Date()));

    const arr = [...state.reservations]
      .sort((a,b) => (a.check_in+a.check_out).localeCompare(b.check_in+b.check_out));

    arr.forEach(r => {
      const div = document.createElement("div");
      div.className = "small-row";

      const src = (r.source || "digiy").toLowerCase();
      let srcLabel = "DIGIY";
      if(src === "booking") srcLabel = "Booking.com";
      else if(src === "ota") srcLabel = "Autre OTA";
      else if(src === "direct") srcLabel = "Direct";

      const futureMark = (r.check_in >= nowISO) ? "üü¢" : "‚ö™Ô∏è";

      div.innerHTML = `
        <div>
          <strong>${futureMark} ${r.guest_name || "Client"}</strong>
          <span style="font-size:11px;opacity:0.9;"> (${srcLabel})</span><br>
          <span>${r.check_in} ‚Üí ${r.check_out}</span><br>
          <span style="font-size:12px;opacity:0.9;">${r.phone || ""}</span>
        </div>
      `;
      box.appendChild(div);
    });
  }

  // üëâ Status message
  function setStatus(msg,type){
    const el = document.getElementById("status");
    el.textContent = msg || "";
    el.className = "";
    if(type === "ok") el.classList.add("status-ok");
    else if(type === "error") el.classList.add("status-error");
  }

  // üëâ Formulaire : ajout de r√©servation
  async function onSubmitForm(e){
    e.preventDefault();
    setStatus("Enregistrement en cours‚Ä¶","info");

    if(!state.rooms || state.rooms.length === 0){
      setStatus("Pas de chambre trouv√©e pour Chez Baptiste.","error");
      return;
    }

    const guestName = document.getElementById("guestName").value.trim();
    const phone     = document.getElementById("phone").value.trim();
    const checkIn   = document.getElementById("checkIn").value;
    const checkOut  = document.getElementById("checkOut").value;
    const source    = document.getElementById("source").value;
    const comment   = document.getElementById("comment").value.trim();

    if(!guestName || !checkIn || !checkOut){
      setStatus("Merci de remplir au moins nom, arriv√©e, d√©part.","error");
      return;
    }

    if(checkOut <= checkIn){
      setStatus("La date de d√©part doit √™tre apr√®s la date d‚Äôarriv√©e.","error");
      return;
    }

    const room = state.rooms[0]; // planning 100% Chez Baptiste = 1 appart
    const ciDate = new Date(checkIn+"T00:00:00");
    const coDate = new Date(checkOut+"T00:00:00");

    // V√©rifier la collision simple c√¥t√© front
    const conflict = state.reservations.some(r => {
      if(r.room_id !== room.id) return false;
      const rci = new Date(r.check_in+"T00:00:00");
      const rco = new Date(r.check_out+"T00:00:00");
      // chevauchement : rci < co && rco > ci
      return rci < coDate && rco > ciDate;
    });

    if(conflict){
      setStatus("Conflit : une autre r√©servation couvre d√©j√† tout ou partie de ces dates.","error");
      return;
    }

    const payload = {
      room_id: room.id,
      guest_name: guestName,
      phone,
      source,
      check_in: checkIn,
      check_out: checkOut,
      status: "confirmed",
      comment
    };

    const btn = document.getElementById("btnSave");
    btn.disabled = true;

    try{
      const { error } = await client
        .from("loc_reservations")
        .insert([payload]);

      if(error){
        console.error(error);
        setStatus("Erreur Supabase : " + error.message,"error");
      } else {
        setStatus("‚úÖ R√©servation enregistr√©e pour " + guestName,"ok");
        document.getElementById("resaForm").reset();
        // Reset dates par d√©faut
        initFormDates();
        await loadData();
      }
    } catch(err){
      console.error(err);
      setStatus("Erreur inattendue. R√©essaie dans un instant.","error");
    } finally{
      btn.disabled = false;
    }
  }

  function initFormDates(){
    const today = stripTime(new Date());
    const ci = document.getElementById("checkIn");
    const co = document.getElementById("checkOut");
    ci.value = toISODate(today);
    co.value = toISODate(addDays(today,1));
  }

  // üëâ Navigation boutons
  document.getElementById("btnPrev").addEventListener("click", () => {
    state.startDate = addDays(state.startDate, -state.days);
    loadData();
  });
  document.getElementById("btnNext").addEventListener("click", () => {
    state.startDate = addDays(state.startDate, state.days);
    loadData();
  });
  document.getElementById("btnToday").addEventListener("click", () => {
    state.startDate = stripTime(new Date());
    loadData();
  });

  document.getElementById("resaForm").addEventListener("submit", onSubmitForm);

  // üëâ Boot
  (function init(){
    initFormDates();
    loadData();
  })();
</script>
</body>
</html>
